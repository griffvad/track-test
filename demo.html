<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<title>Text track demo</title>
<style>
	video::-webkit-media-controls-panel {
		background-color:#000;
	}
</style>
<script>
function print(str) {
    // Use createTextNode so we don't need to do escaping
    var out = document.getElementById("output");
    var p = document.createElement("p");
    var content = document.createTextNode(str);
    p.appendChild(content);
    out.insertBefore(p, out.firstChild);
}

function varDump(object) {
    var output = "{";
    for (property in object) {
        output += property + ': ' + object[property]+'; ';
    }
    output += "}";
    return output;
}

function getTracks(player, type) {
    if(type == "audio") {
        return player.audioTracks;
    } else if (type == "text") {
        return player.textTracks;
    } else if (type == "video") {
        return player.videoTracks;
    }
    throw("Invalid type: " + type);
}

function listTracks(player, type) {
    print("---");
    var length;
    try {
        var tracks = getTracks(player, type);
        for(var j = 0; j < tracks.length; ++j) {
            var track = tracks[j];
            print(type + " track[" + j + "]: " + varDump(track));
        }
        length = tracks.length;
        print("Listing " + length + " " + type + " tracks.");
    } catch (e) {
        print(e);
        print("Error listing " + type + " tracks.");
    }
}

function enableTrack(player, type, i, mode) {
    print(((mode == true || mode == "showing") ? "Enabling " : "Disabling ") + type + " track " + i);
    try {
        var tracks = getTracks(player, type);
        var track = tracks[i];
        if(type == "audio") {
            track.enabled = mode;
        } else if (type == "text") {
            track.mode = mode;
        } else if (type == "video") {
            track.selected = mode;
        }
    } catch (e) {
        print(e);
        return false;
    }
}

function setupControls(player, controlsId, type) {
    var container = document.getElementById(controlsId);

    // Remove existing controls
    while (container.firstChild) {
        container.removeChild(container.firstChild);
    }

    var button = document.createElement("button");
    var label = document.createTextNode("Show");
    button.appendChild(label);
    button.onclick = function() {
        listTracks(player, type);
    };
    container.appendChild(button);

    var tracks;
    if(type == "audio") {
        tracks = player.audioTracks;
    } else if (type == "text") {
        tracks = player.textTracks;
    } else if (type == "video") {
        tracks = player.videoTracks;
    } else {
        print("Invalid type: " + type);
        return;
    }
    if(!tracks) {
        return;
    }

    print("There are " + tracks.length + " " + type + " tracks.");
    for(var i = 0; i < tracks.length; ++i) {
        var button = document.createElement("button");
        var label = document.createTextNode("Enable " + i);
        button.appendChild(label);
        if(type == "audio" || type == "video") {
            button.onclick = enableTrack.bind(this, player, type, i, true);
        } else {
            button.onclick = enableTrack.bind(this, player, type, i, "showing");
        }
        container.appendChild(button);

        button = document.createElement("button");
        label = document.createTextNode("Disable " + i);
        button.appendChild(label);
        if(type == "audio" || type == "video") {
            button.onclick = enableTrack.bind(this, player, type, i, false);
        } else {
            button.onclick = enableTrack.bind(this, player, type, i, "disabled");
        }
        container.appendChild(button);
    }
}

function setupHandlers() {
    try {
        var player = document.getElementsByTagName("video")[0];
        var types = ["audio", "text", "video"];
        for (var i = 0; i < types.length; ++i) {
            var type = types[i];
            var list = player[type + "Tracks"];
            if (list) {
                var func = setupControls.bind(this, player, type + "Controls", type);
                list.addEventListener("addtrack", func);
                list.addEventListener("removetrack", func);
                func();
            } else {
                print("No " + type + " tracks.");
            }
        }
    } catch (e) {
        print(e);
    }
}
</script>
</head>

<body>
<p>
<video id="exampleVideo" controls="controls" width="640" height="480" onloadstart="setupHandlers();">
    <source type="video/mpegts" src="scte20_scte21_ntsc_dtvcc_7.mpg">
    <source type="video/x-matroska" src="http://ftp.nluug.nl/ftp/graphics/blender/apricot/trailer/Sintel_Trailer1.480p.DivX_Plus_HD.mkv">
    <source type="video/mpegts" src="scte20_scte21_ntsc_dtvcc_7.mpg">
    <source type="video/ogg" src="sintel_trailer-480p.ogv">v
    <source type="video/ogg" src="test.ogv">
    <source type="video/x-matroska" src="test.mkv">
    <!--<track src="subtitles.vtt" kind="subtitles" srclang="en" label="English" />-->
</video>
</p>

<h2>VideoTrackList</h2>
<p id="videoControls">
</p>

<h2>AudioTrackList</h2>
<p id="audioControls">
</p>

<h2>TextTrackList</h2>
<p id="textControls">
</p>

<div id="output"></div>

</body></html>
